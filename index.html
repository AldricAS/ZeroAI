<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ZeroAI</title>
<script src="https://js.puter.com/v2/"></script>

<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{
  height:100%;
  background:#020617;
  color:white;
  font-family:system-ui;
  overflow:hidden;
}
#app{
  display:flex;
  flex-direction:column;
  height:100%;
  max-width:600px;
  margin:auto;
  padding:10px;
}
.logo{
  width:140px;
  margin:0 auto 10px;
}
#chat{
  flex:1;
  overflow-y:auto;
  border:1px solid #1e293b;
  border-radius:12px;
  padding:10px;
  margin-bottom:10px;
}
.msg{
  margin-bottom:10px;
  padding:8px 12px;
  border-radius:10px;
  white-space:pre-wrap;
  word-break:break-word;
  max-width:85%;
}
.user{
  background:#2563eb;
  align-self:flex-end;
}
.ai{
  background:#020617;
  border:1px solid #334155;
  align-self:flex-start;
}

/* ===== LOADING ===== */
.loading{
  display:flex;
  align-items:center;
  gap:8px;
}
.spinner{
  width:14px;
  height:14px;
  border:2px solid #334155;
  border-top-color:#22c55e;
  border-radius:50%;
  animation:spin .8s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* ===== CODE BOX ===== */
.code-box{
  position:relative;
  background:#020617;
  border:1px solid #334155;
  border-radius:10px;
  padding:12px;
  margin:8px 0;
  overflow-x:auto;
  font-family:monospace;
  font-size:14px;
}
.copy-btn{
  position:absolute;
  top:6px;
  right:6px;
  background:#22c55e;
  color:white;
  border:none;
  border-radius:6px;
  padding:4px 8px;
  font-size:12px;
}

/* ===== INPUT ===== */
#input{
  display:flex;
  gap:5px;
}
textarea{
  flex:1;
  resize:none;
  padding:10px;
  border-radius:10px;
  border:none;
  font-size:16px;
}
button{
  padding:10px 15px;
  border:none;
  border-radius:10px;
  background:#22c55e;
  color:white;
  font-weight:bold;
}
#btn-clear{
  background:#ef4444;
  margin-top:5px;
}
</style>
</head>

<body>
<div id="app">
  <img src="https://i.ibb.co.com/rKYv9K44/20251221-165128.jpg" class="logo">
  <div id="chat"></div>

  <div id="input">
    <textarea id="text" placeholder="Tanya sesuatu..." rows="2"></textarea>
    <button onclick="send()">Kirim</button>
  </div>
  <button id="btn-clear" onclick="clearChat()">Hapus Chat</button>
</div>

<script>
const chat = document.getElementById("chat");

/* ===== LOAD HISTORY ===== */
let history = (JSON.parse(localStorage.getItem("zeroai_history")) || [])
  .map(m => ({...m, loading:false}));

function render(){
  chat.innerHTML="";
  history.forEach(m=>{
    if(!m.text && !m.loading) return;

    const div=document.createElement("div");
    div.className="msg "+m.role;

    if(m.loading){
      div.classList.add("loading");
      div.innerHTML=`<span>ZeroAI sedang berpikir</span><div class="spinner"></div>`;
    }else{
      // ==== SPLIT TEXT & CODE ====
      if(m.text.includes("```")){
        const parts = m.text.split("```");
        div.innerHTML="";

        parts.forEach((part,i)=>{
          // CODE
          if(i % 2 === 1){
            let code = part.replace(/^[a-zA-Z]+\n/, "");
            const box=document.createElement("div");
            box.className="code-box";
            box.innerHTML=`
              <button class="copy-btn" onclick="copyCode(this)">Salin</button>
              <pre>${code.replace(/</g,"&lt;")}</pre>
            `;
            div.appendChild(box);
          }
          // TEXT
          else if(part.trim()){
            const text=document.createElement("div");
            text.textContent=part.trim();
            div.appendChild(text);
          }
        });
      }else{
        div.textContent=m.text;
      }
    }
    chat.appendChild(div);
  });
  chat.scrollTop=chat.scrollHeight;
}
render();

/* ===== COPY CODE ===== */
function copyCode(btn){
  const code = btn.nextElementSibling.innerText;
  navigator.clipboard.writeText(code);
  btn.textContent="Tersalin!";
  setTimeout(()=>btn.textContent="Salin",1500);
}

/* ===== TYPE EFFECT ===== */
function typeEffect(obj,text){
  let i=0;
  obj.text="";
  const timer=setInterval(()=>{
    obj.text+=text.charAt(i);
    render();
    i++;
    if(i>=text.length){
      clearInterval(timer);
      localStorage.setItem("zeroai_history",JSON.stringify(history));
    }
  },20);
}

/* ===== SEND ===== */
async function send(){
  const input=document.getElementById("text");
  if(!input.value.trim()) return;

  history.push({role:"user",text:input.value});
  render();

  const prompt=`
Kamu adalah AI bernama ZeroAI.
ATURAN:
- Jika ditanya "siapa namamu", jawab: "Namaku ZeroAI."
- Jika ditanya "siapa pembuatmu", jawab: "Aku dibuat oleh Aldric Adelard Saputra."
- Gunakan bahasa santai Indonesia.

User: ${input.value}
`;

  input.value="";
  const aiMsg={role:"ai",text:"",loading:true};
  history.push(aiMsg);
  render();

  try{
    const res=await puter.ai.chat(prompt);
    const answer=typeof res==="string"?res:res?.message?.content||"⚠️ Tidak ada jawaban";
    aiMsg.loading=false;
    typeEffect(aiMsg,answer);
  }catch(e){
    aiMsg.loading=false;
    aiMsg.text="❌ ERROR: ZeroAI gagal merespon";
    render();
  }
}

/* ===== CLEAR ===== */
function clearChat(){
  if(confirm("Hapus semua chat?")){
    history=[];
    localStorage.removeItem("zeroai_history");
    render();
  }
}
</script>
</body>
</html>
